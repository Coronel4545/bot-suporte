const express = require("express");
const cors = require("cors");
const app = express();
const TelegramBot = require("node-telegram-bot-api");
const adminChatId = -1002476380280;
const token = "7570626039:AAGQ0L2nZdaz2KEkPqn2gA3ABjkbJ4IhFWA";
const bot = new TelegramBot(token, { polling: true });


app.use(cors()); // Permite requisi√ß√µes de qualquer origem

// Rota HTTP para o UptimeRobot pingar
app.get("/", (req, res) => {
  res.send("O bot est√° rodando corretamente.");
});




// Inicia o servidor na porta definida pelo provedor ou 3000
const port = process.env.PORT || 3000;
app.listen(port, () => {
  console.log(`Servidor rodando na porta ${port}`);
});

// L√≥gica para novos membros do chat
bot.on("new_chat_members", (msg) => {
  const newMember = msg.new_chat_members
    ? msg.new_chat_members[0].first_name
    : "Membro";
  const BoasVindas = `Bem-vindo(a) ${newMember}! üéâ Deixe sua d√∫vida no chat ou aguarde at√© que um membro da equipe entre em contato com voc√™ para resolu√ß√£o do seu problema. Voc√™ tamb√©m pode me fazer uma pergunta! ou olhar nosso tutorial atrav√©s do link >> https://tutorial-sobre-plataforma-de-bus.gitbook.io/tutorialbuscadados`;

  bot.sendMessage(msg.chat.id, BoasVindas);
  console.log("NOVO USU√ÅRIO: ", BoasVindas);
});

// Fun√ß√£o para lidar com mensagens recebidas
function handleMessage(msg) {
  const chatId = msg.chat.id;
  if (!msg.text) {
    return;
  }
   
  const messageText = msg.text.toLowerCase();
  console.log("Mensagem recebida:", messageText); // Log para depura√ß√£o
if (chatId == adminChatId) {
    console.log('N√ÉO RESPONDIDO, POIS A REQUISI√á√ÉO VEM DE: ', adminChatId);
    return; 
  }else if (
    messageText.includes("ol√°") ||
    messageText.includes("oi") ||
    messageText.includes("/start") ||
    messageText.includes("oi?") ||
    messageText.includes("ol√°?")
  ) {
    const PrimeiroContato = "Ol√°! Como posso ajudar voc√™ hoje?";
    bot.sendMessage(chatId, PrimeiroContato);
    console.log("Primeira intera√ß√£o com o cliente:", PrimeiroContato);
  } else if (
    messageText.includes("n√£o recebi os dados") ||
    messageText.includes("n√£o recebi") ||
    messageText.includes("quando recebo?") ||
    messageText.includes("quando recebo") ||
    messageText.includes("quando vou receber") ||
    messageText.includes("at√© agora n√£o recebi os dados") ||
    messageText.includes("os dados n√£o foram enviados") ||
    messageText.includes("os dados n√£o foram enviado a mim") ||
    messageText.includes("paguei mas n√£o recebi") ||
    messageText.includes("paguei e n√£o recebbi") ||
    messageText.includes("n√£o recebi nada") ||
    messageText.includes("n√£o recebi") ||
    messageText.includes("paguei mas n√£o enviaram nada para mim") ||
    messageText.includes("ainda n√£o recebi") ||
    messageText.includes("ainda n√£o me mandaram os dados") ||
    messageText.includes("porque ainda n√£o recebi?") ||
    messageText.includes("por que ainda n√£o recebi?") ||
    messageText.includes("por qu√™ ainda n√£o recebi?") ||
    messageText.includes("porqu√™ ainda n√£o recebi?") ||
    messageText.includes("por que ainda n√£o recebi os dados?") ||
    messageText.includes("por qu√™ ainda n√£o recebi os dados?") ||
    messageText.includes("porqu√™ ainda n√£o recebi os dados?") ||
    messageText.includes("como recebo?") ||
    messageText.includes("como recebo") ||
    messageText.includes("comprei e n√£o recebi") ||
    messageText.includes("eu n√£o recebi") ||
    messageText.includes("eu ainda n√£o recebi")
  ) {
    const RespTempo =
      "Os dados ser√£o enviados em um prazo de at√© 48 horas. Caso tenha passado as 48 horas e voc√™ ainda n√£o recebeu, aguarde o contato de um dos nossos suportes.";
    bot.sendMessage(chatId, RespTempo);
    console.log("Resposta Sobre tempo: ", RespTempo);
  } else if (
    messageText.includes("fiz o pagamento mas n√£o coloquei os dados") ||
    messageText.includes("fiz o pagamento, mas n√£o coloquei os dados") ||
    messageText.includes("fiz o pagamento, mas n√£o coloquei os dados, o que fa√ßo?") ||
    messageText.includes("acabei n√£o colocando os dados") ||
    messageText.includes("acabei n√£o colocando os dados, o que fa√ßo") ||
    messageText.includes("n√£o coloquei meu telefone") ||
    messageText.includes("paguei mas n√£o coloquei meu telefone") ||
    messageText.includes("paguei mas n√£o coloquei meu celular") ||
    messageText.includes("paguei mas n√£o coloquei meu n√∫mero de telefone") ||
    messageText.includes("paguei mas n√£o coloquei meu numero de telefone") ||
    messageText.includes("paguei mas n√£o coloquei meu numero de celular") ||
    messageText.includes("paguei mas n√£o coloquei meu n√∫mero de whatsapp") ||
    messageText.includes("paguei mas n√£o coloquei meu numero de whatsapp") ||
    messageText.includes("Comprei com cripto mas n√£o enviei preenchi com minha carteira") ||
    messageText.includes("paguei mas esqueci de colocar meus dados") ||
    messageText.includes("paguei e n√£o coloquei minha carteira") ||
    messageText.includes("paguei e n√£o coloquei meu nome") ||
    messageText.includes("paguei e n√£o coloquei meu numero") ||
    messageText.includes("paguei e n√£o coloquei o celular") ||
    messageText.includes("apenas paguei e n√£o coloquei os dados") ||
    messageText.includes("n√£o coloquei os dados") ||
    messageText.includes("n√£o coloquei minha wallet") ||
    messageText.includes("n√£o coloquei a carteira de pagamento") ||
    messageText.includes("n√£o coloquei a carteira")
  ) {
    const RespFaltadeDados =
      "Se efetuou o pagamento e esqueceu de colocar os dados. Isso significa que ter√° que entrar em contato com um dos nosso administradores. Experimente chamar o @AbraaoOliveira47 no privado. ";
    bot.sendMessage(chatId, RespFaltadeDados);
    console.log("Resposta sobre falta de dados fornecido pelo cliente: ", RespFaltadeDados);
  } else if (
    messageText.includes("quero reembolso") ||
    messageText.includes("recebi mas est√° errado") ||
    messageText.includes("recebi mais est√° errado") ||
    messageText.includes("recebi mas est√° errado") ||
    messageText.includes("os dados est√£o errados") ||
    messageText.includes("os dados est√£o errados, quero meu dinheiro de volta") ||
    messageText.includes("quero meu dinheiro de volta") ||
    messageText.includes("os dados j√° vieram da forma que eu queria") ||
    messageText.includes("os dados vieram errados") ||
    messageText.includes("os dados est√£o imcompletos") ||
    messageText.includes("os dados est√£o faltando")
  ) {
    const RespErroRecebimentoDeDados =
      "Caso acredite que os dados est√£o incorretos, incompletos ou n√£o vieram da forma que imaginava, aguarde o contato do nosso suporte para uma resposta e solu√ß√£o personalizada.";
    bot.sendMessage(chatId, RespErroRecebimentoDeDados);
    console.log("Respota sobre erro no recebimento dos dados solicitados: ", RespErroRecebimentoDeDados);
  } else if (
    messageText.includes("paguei com cripto, mas n√£o recebi os dados") ||
    messageText.includes("paguei com cripto mas n√£o coloquei minha carteira") ||
    messageText.includes("paguei com cripto") ||
    messageText.includes("paguei com cripto mas n√£o coloquei meu telefone") ||
    messageText.includes("paguei com cripto mas n√£o coloquei meu fone") ||
    messageText.includes("paguei com cripto mas n√£o coloquei meu celular") ||
    messageText.includes("paguei com cripto mas n√£o coloquei meu n√∫mero") ||
    messageText.includes("paguei com cripto mas n√£o coloquei meu n√∫mero de celular") ||
    messageText.includes("paguei com cripto mas n√£o coloquei meu n√∫mero de whatsapp") ||
    messageText.includes("paguei com cripto mas n√£o coloquei meu whatsapp") ||
    messageText.includes("paguei e n√£o coloquei meus dados de contato") ||
    messageText.includes("paguei mas n√£o coloquei meu dados") ||
    messageText.includes("paguei mas n√£o coloquei meus dados de contato") ||
    messageText.includes("paguei e esqueci de colocar os dados")
  ) {
    const faltaDeDados =
      "Se voc√™ pagou e esqueceu de vincular algum dado como carteira de pagamento, n√∫mero de whatsapp ou nome, ter√° que entrar em contato com nosso suporte. @AbraaoOliveira47.";
    bot.sendMessage(chatId, faltaDeDados);
    console.log("Resposta ao esquecimento de v√≠nculo de dados: ", faltaDeDados);
  } else if (
    messageText.includes("como funciona?") ||
    messageText.includes("como usar?") ||
    messageText.includes("como funciona") ||
    messageText.includes("como usar") ||
    messageText.includes("tutorial") ||
    messageText.includes("como usa?") ||
    messageText.includes("como usa") ||
    messageText.includes("como fa√ßo?") ||
    messageText.includes("como fa√ßo") ||
    messageText.includes("me ajuda a usar?") ||
    messageText.includes("me ajude a usar") ||
    messageText.includes("me ensina a usar") ||
    messageText.includes("me ensina?") ||
    messageText.includes("como funciona o processo?") ||
    messageText.includes("como funciona o sistema?") ||
    messageText.includes("como funciona o que voc√™ est√° vendendo?") ||
    messageText.includes("como funciona o seu servi√ßo?")
  ) {
    const comoFunciona =
      "Para utilizar a plataforma, √© simples! Basta escolher a op√ß√£o que se encaixa com o dado que voc√™ tem em m√£os e clicar nela. Ao entrar, o sistema solicitar√° os dados. Leia atentamente e preencha cada um deles. Em at√© 48 horas, os dados ser√£o enviados ao seu n√∫mero de contato.Olhe tamb√©m nosso whitepaper(Manual do cliente) em https://tutorial-sobre-plataforma-de-bus.gitbook.io/tutorialbuscadados";
    bot.sendMessage(chatId, comoFunciona);
    console.log("Resposta sobre como funciona: ", comoFunciona);
  } else if (
    messageText.includes("n√£o consigo acessar") ||
    messageText.includes("n√£o consigo entrar") ||
    messageText.includes("n√£o estou conseguindo acessar") ||
    messageText.includes("n√£o estou conseguindo entrar") ||
    messageText.includes("n√£o estou conseguindo logar") ||
    messageText.includes("estou tendo dificuldade de acessar") ||
    messageText.includes("estou tendo dificuldade de entrar") ||
    messageText.includes("estou tendo dificuldade de logar") ||
    messageText.includes("n√£o consigo logar") ||
    messageText.includes("n√£o consigo entrar na plataforma")
  ) {
    const dificuldadeDeAcesso =
      "N√£o existe uma assinatura. O que oferecemos √© um sistema de solicita√ß√£o a consulta de dados. O fragmento de informa√ß√£o √© fornecido por voc√™, e ent√£o n√≥s te entregamos um complemento desses dados (se presente) pelo meio de contato que voc√™ nos forneceu.√â um servi√ßo √∫nico, direto e simplificado.";
    bot.sendMessage(chatId, dificuldadeDeAcesso);
    console.log("Resposta sobre dificuldade de acesso: ", dificuldadeDeAcesso);
  } else if (
    messageText.includes("quero cancelar") ||
    messageText.includes("quero reembolso") ||
    messageText.includes("quero rembolso") ||
    messageText.includes("posso pedir reembolso?") ||
    messageText.includes("cancelar assinatura") ||
    messageText.includes("cancelar pagamento") ||
    messageText.includes("quero cancelar assinatura") ||
    messageText.includes("quero cancelar meu pagamento") ||
    messageText.includes("quero cancelar meu servi√ßo")||
    messageText.includes("quero meu dinheiro!")||
    messageText.includes("quero meu dinheiro") ||
    messageText.includes("quero meu dinheiro de volta")
  ) {
    const cancelamento =
      "N√≥s n√£o fornecemos m√©todos de assinaturas. Cada solicita√ß√£o de reembolso deve ser tratada com o @AbraaoOliveira47, para que possa ser analisada e resolvida da melhor forma poss√≠vel por ambas as partes.";
    bot.sendMessage(chatId, cancelamento);
    console.log("Resposta sobre cancelamento: ", cancelamento);
  }else if(messageText.includes("link")||
           messageText.includes("site")||
           messageText.includes("acesso")||
           messageText.includes("website")||
           messageText.includes("web")||
           messageText.includes("busca")||
           messageText.includes("buscar")||
           messageText.includes("qual site?")||
           messageText.includes("me passa o link")||
           messageText.includes("me passa o site")
          
  ){
    const indicarSite = "Para realizar solicita√ß√µes de busca, acesse nosso portal >> https://buscadados.org";
    bot.sendMessage(chatId, indicarSite);
    console.log('Resposta de indica√ß√£o do site: ', indicarSite)
  } else {
    const defaultResponse =
      "Desculpe, n√£o consegui entender sua pergunta. Voc√™ poderia reformular? Atente-se para erros ortogr√°ficos, caracteres especiais e espa√ßamentos adicionais. Sou um modelo de respostas baseado em condicionais, tenho limita√ß√µes quanto a respostas.Fui desenvolvido com o prop√≥sito de ajudar a responder d√∫vidas.";
    bot.sendMessage(chatId, defaultResponse);
    console.log("Resposta padr√£o: ", defaultResponse);
  }
}

bot.on("message", handleMessage);

bot.on("polling_error", (error) => {
  //console.error("Polling Error:", error);
});
